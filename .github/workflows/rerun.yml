name: Re-Run Unverified PRs
on:
    workflow_dispatch:

jobs:
  send_pull_requests:
    runs-on: ubuntu-latest
    name: Re-Execute any Autotest PR checks
    steps:
      - uses: actions/checkout@v4
        with: 
          token: ${{secrets.GITHUB_TOKEN}}


      - name: Empty Commits
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        run: |
          cd $GITHUB_WORKSPACE
          git fetch --all
          git branch -r >branches.list
          #cat branches.list
          cat branches.list|grep \/diff\/ |sed 's|origin/||g' >branches2.list
          cat branches2.list                

          git config --global user.email ${{ github.actor }}@users.noreply.github.com
          git config --global user.name "${{ github.actor }}"

          while read branch; do
            echo "Branch: $branch"
            git checkout $branch
            git commit --allow-empty -m "Triggering Autotest Workflow Re-Run"
            git push origin $branch
          done <branches2.list  
